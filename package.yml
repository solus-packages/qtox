name       : qtox
version    : 1.12.1
release    : 21
source     :
    - https://github.com/qTox/qTox/archive/v1.12.1.tar.gz : 65b25b9ced6b163d19d75800cc44394785a3281b2376c1f9f2ecffce96029e37
license    : GPL-3.0
component  : network.im
summary    : qTox is a powerful Tox client
description: |
    The most feature-rich Tox client; P2P instant messaging, audio and video calls.
builddeps  :
    - pkgconfig(filteraudio)
    - pkgconfig(gdk-pixbuf-2.0)
    - pkgconfig(gtk+-2.0)
    - pkgconfig(libavcodec)
    - pkgconfig(libexif)
    - pkgconfig(libqrencode)
    - pkgconfig(libsodium)
    - pkgconfig(libtoxcore)
    - pkgconfig(openal)
    - pkgconfig(opencv)
    - pkgconfig(opus)
    - pkgconfig(Qt5Help)
    - pkgconfig(Qt5Svg)
    - pkgconfig(sqlcipher)
    - pkgconfig(vpx)
    - pkgconfig(xscrnsaver)
setup      : |
    %patch -p1 < $pkgfiles/0001-backout-werror.patch
    sed -i -e 's|AudioVideo;||g' qtox.desktop
    %cmake .
build      : |
    %make
install    : |
    install -Dm00755 qtox $installdir/usr/bin/qtox
    install -Dm00644 qtox.desktop $installdir/usr/share/applications/qtox.desktop
    cd img/icons
    rm qtox*
    for size in *x*; do
        install -Dm00644 "$size/qtox.png" "$installdir/usr/share/icons/hicolor/$size/apps/qtox.png"
    done
check      : |
    %make test
